{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Events â€” Vaquero Social</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="{% static 'css/common.css' %}" />
  <link rel="stylesheet" href="{% static 'css/event.css' %}" />
</head>

<body>

<div class="container">

  <!-- Header -->
  <header class="appbar">
    <div class="top-left">
      <div class="back-btn" onclick="history.back()">â†</div>
      <div class="brand">
        <img src="https://images.vexels.com/media/users/3/252889/isolated/preview/02e0a9c8d1b16f3f23d96715d114168e-cowboy-with-lasso-and-horse-silhouette.png" 
             alt="Logo (Cowboy holding a lasso)" style="width:32px; height:32px; border-radius:50%; object-fit:cover; margin-right:8px;" />
        Lasso
      </div>
    </div>

    <div class="search">
      <input id="searchInput" placeholder="Search campus..." />
    </div>

    <div class="top-actions">
      <div id="notifyBell" style="background:white;padding:8px;border-radius:8px;cursor:pointer;">ğŸ””</div>
      <div class="avatar"></div>
    </div>
  </header>

  <!-- Sidebar -->
  <aside class="sidebar">
    <nav class="nav">
      <a href="{% url 'feed' %}">ğŸ  Home</a>
      <a href="{% url 'messages' %}">ğŸ’¬ Messages</a>
      <a href="{% url 'events' %}" class="active">ğŸ“… Events</a>
      <a href="{% url 'profile' %}">ğŸ‘¤ Profile</a>
    </nav>
    <form method="post" action="{% url 'logout' %}" style="margin:0;">
      {% csrf_token %}
      <button type="submit" class="logout">âŸ² Log out</button>
    </form>
  </aside>

  <!-- Main Content -->
  <main class="events-main">
    <div class="events-header">
      <h2>Campus Events</h2>
      <a href="#" class="create-event-btn" onclick="toggleCreateForm(); return false;">+ Create Event</a>
    </div>

    <!-- Create Event Form (hidden by default) -->
    <div id="createEventForm" class="create-event-form" style="display:none;">
      <div class="form-card">
        <h3>Create New Event</h3>
        <form method="post" action="{% url 'create_event' %}">
          {% csrf_token %}
          <label>Event Title:
            <input type="text" name="title" placeholder="Enter event title" required>
          </label>
          <label>Event Date:
            <input type="date" name="date" required>
          </label>
          <label>Event Description:
            <textarea name="description" placeholder="Enter event description" rows="4" required></textarea>
          </label>
          <div class="form-actions">
            <button type="submit" class="event-btn">Create Event</button>
            <button type="button" class="cancel-btn" onclick="toggleCreateForm()">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Events Grid -->
    <div class="events-wrapper">
      {% for item in events_with_data %}
      <div class="event-card">
        <div class="event-header-info">
          <div class="event-host">
            <div class="host-avatar">
              {% if item.event.hosted_by_user.profile.profile_picture %}
                <img src="{{ item.event.hosted_by_user.profile.profile_picture.url }}" alt="{{ item.event.hosted_by_user.username }}">
              {% else %}
                {{ item.event.hosted_by_user.username|slice:":1"|upper }}
              {% endif %}
            </div>
            <span>Hosted by {{ item.event.hosted_by_user.username }}</span>
          </div>
        </div>
        
        <h3 class="event-title">{{ item.event.title }}</h3>
        <p class="event-date">ğŸ“… {{ item.event.date|date:"F d, Y - g:i A" }}</p>
        {% if item.event.location %}
        <p class="event-location">ğŸ“ {{ item.event.location }}</p>
        {% endif %}
        <p class="event-description">{{ item.event.description }}</p>
        
        <div class="event-footer">
          <div class="rsvp-count">ğŸ‘¥ {{ item.rsvp_count }} attending</div>
          
          {% if user.is_authenticated %}
            {% if item.event.hosted_by_user == user %}
              <!-- If user is host, show delete button -->
              <form method="post" action="{% url 'delete_event' item.event.event_id %}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this event?');">
                {% csrf_token %}
                <button type="submit" class="event-btn-outline" style="background:#dc3545;color:white;">Delete Event</button>
              </form>
            {% else %}
              <!-- If user is not host, show RSVP buttons -->
              <form method="post" action="{% url 'event_rsvp' item.event.event_id %}" style="display:inline;">
                {% csrf_token %}
                {% if item.user_rsvp == 'going' %}
                  <button type="submit" name="status" value="going" class="event-btn active">âœ“ Going</button>
                  <button type="submit" name="status" value="not_going" class="event-btn-outline">Cancel</button>
                {% else %}
                  <button type="submit" name="status" value="going" class="event-btn">RSVP</button>
                {% endif %}
              </form>
            {% endif %}
          {% else %}
          <a href="{% url 'login' %}" class="event-btn">Login to RSVP</a>
          {% endif %}
        </div>
      </div>
      {% empty %}
      <div class="event-card">
        <h3 class="event-title">No events yet</h3>
        <p class="event-description">
          Be the first to create an event! Click "+ Create Event" above to get started.
        </p>
      </div>
      {% endfor %}
    </div>
  </main>

  <!-- Right sidebar (optional) -->
  <aside class="right-col">
    <!-- Empty for now -->
  </aside>

</div>

<script>
function toggleCreateForm() {
  const form = document.getElementById('createEventForm');
  form.style.display = form.style.display === 'none' ? 'block' : 'none';
}
</script>

</body>
</html> 